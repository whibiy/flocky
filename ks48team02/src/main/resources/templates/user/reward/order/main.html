<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout/default}">

<head>
    <!--  사용자별 css file 추가 부분 -->
    <!-- Link Swiper's CSS -->
    <style>




        #payment-button{ width:100%; padding:15px; background-color:#3065AC; color:white; border-radius:3px; font-size:16px; border:none; margin-top:10px}
        .title {margin: 0 0 4px; font-size: 24px; font-weight: 600;color: #4e5968;}
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
    <link rel="stylesheet" th:href="@{/user/css/swiper-event-css.css}" />
    <link rel="stylesheet" th:href="@{/user/css/main_style.css}" />

</head>


<!-- 사용자 페이지별 javascript file -->
<th:block layout:fragment="customJsFile">
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <!-- 	  	<script th:src="@{user/js/swiper-slide-event.js}"></script> -->

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!--  다음 주소찾기 api   -->

    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
    <!--   토스페이-->




</th:block>


<!-- 사용자별 스크립트 작성 -->
<th:block layout:fragment="customJsCode">

    <script th:inline="javascript">
        //토스페이에 담을 주문 상품 정보
        const products =[];
        //등급 별 할인율
        let orderMemberDiscount = Number([[${orderMemberInfo.rewardCustomerRank.discountRate}]]);
        //등급 별 적립 포인트
        let orderMemberSavePoint = Number([[${orderMemberInfo.rewardCustomerRank.pointSavingRate}]]);
        //회원 보유 포인트
        let havePoint = [[${orderMemberInfo.customer.customerPoint}]];
        //주문자 회원 정보
        let name = [[${orderMemberInfo.memberName}]];
        let mobile = [[${orderMemberInfo.memberContactInfo}]];
        let addr = [[${orderMemberInfo.customer.customerAddr}]];
        let addrDetail = [[${orderMemberInfo.customer.customerAddrDetail}]];
        let id = [[${orderMemberInfo.memberId}]];

        $(function(){

            //토스 api CustomerKey를 랜덤 생성하기위한 generateUUID 함수
            function generateUUID() { // Public Domain/MIT
                var d = new Date().getTime();//Timestamp
                var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16;//random number between 0 and 16
                    if(d > 0){//Use timestamp until depleted
                        r = (d + r)%16 | 0;
                        d = Math.floor(d/16);
                    } else {//Use microseconds since page-load if supported
                        r = (d2 + r)%16 | 0;
                        d2 = Math.floor(d2/16);
                    }
                    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
                });
            }

            //유효성 검사 validationCheck 함수
            function validationCheck(data) {
                let isValid =true;

                //1.인수 값이 객체일 경우
                if(typeof data =='object') {

                    $.each(data, function(){
                        let checkValue = $(this).val();
                        if(checkValue === null || checkValue === '' || checkValue === 'undefined') {
                            isValid = false;
                            let eleId = $(this).attr('id');
                            let cate = $(`label[for="${eleId}"]`).text();
                            alert(`${cate} 필수 입력 항목입니다.`);
                            $(this).focus();
                            return isValid;
                        }
                    });
                    //2.인수 값이 객체가 아닐 경우
                }else{
                    if(data === null || data === '' || data === 'undefined') {
                        isValid = false;
                    }
                }
                return isValid;
            }

            // 다음 버튼 클릭시 페이지 이동, 선택한 옵션 정보 입력
            $('.nextBtn').click(function(){

                //토스페이에 받을 제품 배열 초기화,
                products.length = 0;

                if($('#orderInfo').find('input[type="checkbox"]:checked').length < 1) {
                    alert('리워드를 선택해 주세요');
                    return;
                }

                $(this).parents('.info-contents-area').hide();
                $(this).parents('.info-contents-area').next().show();


                let selectOption = $('#orderInfo').find('input[type="checkbox"]:checked').parents('.selectOption');
                // 총 리워드 주문 금액
                let totalRewardPrice = 0;
                // 주문 시 배송비
                let orderDeliverPrice = 0;

                $(selectOption).each(function(idx,item){

                    let rewardOptionCode = $(this).find('input[type="checkbox"]').attr('id');
                    let optionName = $(item).find('.optionName').text();
                    let optionContents = $(item).find('.optionContents').text();
                    let optionPrice = $(item).find('.optionPrice').data('price');
                    let optionAmount = $(item).find('.optionAmount').val();
                    let optionDeliverPrice = $(item).find('.optionDeliverPrice').data('price');

                    //토스페이에 담을 옵션 정보 객체.
                    const product ={};
                    product.optionName = optionName;
                    product.optionPrice = optionPrice;
                    product.orderQuantity = Number(optionAmount);
                    product.rewardOptionCode = rewardOptionCode;
                    product.rewardProjectCode = [[${rewardOrderInfo.rewardProjectCode}]];
                    product.pricePerOption = Number(optionPrice) * Number(optionAmount);
                    products.push(product);

                    //옵션들 배송비 중 가장 높은 배송비 추출.
                        if(optionDeliverPrice > orderDeliverPrice) {
                            orderDeliverPrice = optionDeliverPrice;
                        }

                    //선택된 옵션 순회하면서 옵션 금액을 리워드 금액에 합산
                    totalRewardPrice += (optionPrice * optionAmount);

                    // 선택한 옵션태그 담을 변수
                    let addSelectedOption;

                    addSelectedOption = $('<div class="my-lg-1" style="height: 35px">\n' +
                        '                                    <div style="border: 0.2px solid #f3f4f5; margin: 5px; width: 100%"></div>\n' +
                        '                                    <span class="orderOptionName ml-2"></span>\n' +
                        '                                    <span class="orderOptionPrice font-weight-bold float-right mr-lg-2"></span>\n' +
                        '                                    <span class="font-weight-bold float-right mr-lg-2">수량 : <span class="orderOptionAmount"></span>개 </span>\n' +
                        '                                    <br>\n' +
                        '                                </div>');


                    $(addSelectedOption).find('.orderOptionName').text(optionName);
                    $(addSelectedOption).find('.orderOptionPrice').text(`${(optionPrice * optionAmount).toLocaleString('ko-KR')} 원`);
                    $(addSelectedOption).find('.orderOptionAmount').text(optionAmount);
                    $('#selectedOption').prepend($(addSelectedOption));
                });
                //보유 포인트
                if(havePoint) {
                    $('#havePoint').text(`${havePoint.toLocaleString('ko-KR')}`);
                }

                // 최종 리워드 비용
                $('#totalRewardPrice').text(`${totalRewardPrice.toLocaleString('ko-KR')} 원`);

                //등급 별 할인 금액
                $('#memberRankDiscount').text(`${Number(totalRewardPrice * orderMemberDiscount).toLocaleString('ko-KR')} 원`);

                //등급 별 적립 금액
                $('#memberSavePoint').text(`${Number(totalRewardPrice * orderMemberSavePoint).toLocaleString('ko-KR')} 원`)

                // 배송비에 따라 최종 결제 배송비, 결제비용
                if(orderDeliverPrice == 0) {
                    $('.orderOptionDeliverPrice').text('무료 배송');
                    $('#totalOrderDeliverPrice').text('무료 배송');
                    $('#totalPayPrice').text(`${Number(totalRewardPrice*(1-orderMemberDiscount)).toLocaleString('ko-KR')} 원`);
                } else {
                    $('.orderOptionDeliverPrice').text(`${orderDeliverPrice.toLocaleString('ko-KR')} 원`);
                    $('#totalOrderDeliverPrice').text(`${orderDeliverPrice.toLocaleString('ko-KR')} 원`);
                    $('#totalPayPrice').text(`${Number((totalRewardPrice*(1-orderMemberDiscount) + orderDeliverPrice)).toLocaleString('ko-KR')} 원`);
                }
                $('#memberRankDiscount').data('price',(totalRewardPrice * orderMemberDiscount));
                $('#memberSavePoint').data('price',(totalRewardPrice * orderMemberSavePoint));
                $('#totalRewardPrice').data('price',totalRewardPrice);
                $('#totalPayPrice').data('price',(totalRewardPrice * (1-orderMemberDiscount) + orderDeliverPrice));
                $('#totalOrderDeliverPrice').data('price', orderDeliverPrice);
            });

            //쿠폰 사용시 쿠폰 혜택 최종 결제금액에 적용
            $(document).on('change','.orderUseCoupon',function(){
                let totalRewardPrice = $('#totalRewardPrice').data('price');
                let point = Number($('#usePoint').val());
                let coupon = Number($(this).val());
                let deliver = $('#totalOrderDeliverPrice').data('price');
                let paymentPrice =0;

                //쿠폰 금액
                if(coupon <= 0) {
                    paymentPrice =(totalRewardPrice - coupon - point  + deliver);
                    $('#totalPayPrice').text(`${paymentPrice.toLocaleString('ko-KR')} 원`);
                    $('#totalOrderCoupon').text(`${coupon.toLocaleString('ko-KR')} 원`);
                    $('#totalPayPrice').data('price', paymentPrice);
                    $('#totalOrderCoupon').data('price', coupon);

                } else if( coupon > 100) {
                    //일정 금액 할인
                    alert(`${coupon.toLocaleString('ko-KR')} 원 할인`)
                    paymentPrice =(totalRewardPrice * (1-orderMemberDiscount) - coupon - point  + deliver);
                    $('#totalPayPrice').text(`${paymentPrice.toLocaleString('ko-KR')} 원`);
                    $('#totalOrderCoupon').text(`${coupon.toLocaleString('ko-KR')} 원`);
                    $('#totalPayPrice').data('price', paymentPrice);
                    $('#totalOrderCoupon').data('price', coupon);

                } else{
                    //퍼센트 할인
                    alert(`${coupon}% 할인`)
                    paymentPrice = (totalRewardPrice*(1 - (coupon/100 + orderMemberDiscount)) - point  + deliver);
                    $('#totalPayPrice').text(`${paymentPrice.toLocaleString('ko-KR')} 원`);
                    $('#totalOrderCoupon').text(`${(totalRewardPrice*coupon/100).toLocaleString('ko-KR')} 원`);
                    $('#totalPayPrice').data('price', paymentPrice);
                    $('#totalOrderCoupon').data('price', (totalRewardPrice*coupon/100));
                }
            });

            //포인트 모두 사용 체크시, 포인트 금액 보유한 포인트 만큼 변동.
            $(document).on('change','#pointAllCheck',function(){
                let totalPayPrice = $('#totalPayPrice').data('price');

                if($(this).prop('checked')) {
                    if(havePoint > totalPayPrice) {
                        $('#usePoint').val(totalPayPrice);
                        $('#usePoint').change();
                    } else{
                        $('#usePoint').val(havePoint);
                        $('#usePoint').change();
                    }
                } else {
                    $('#usePoint').val(0);
                    $('#usePoint').change();
                }
            });

            //포인트 사용 시 최종 결제 금액에 사용한 포인트 금액 표시, 보유 포인트와 최종 결제 금액을 넘어가면 사용 못하게.
            $(document).on('change','#usePoint',function(){

                let totalRewardPrice = $('#totalRewardPrice').data('price');
                let totalPayPrice = $('#totalPayPrice').data('price');
                let point = Number($(this).val());
                let coupon = Number($('.orderUseCoupon').val());
                let deliver = $('#totalOrderDeliverPrice').data('price');

                let paymentPrice =0;

                //가지고 있는 포인트 입력하면 가지고 있는 포인트 만큼으로 대체
                if(point >= havePoint) {
                    point = havePoint;
                    $(this).val(havePoint);
                    $('#pointAllCheck').prop('checked',true);
                } else {
                    $('#pointAllCheck').prop('checked',false);
                }

                //포인트 결제 금액보다 높으면 다시 입력하게.
                if(point > totalPayPrice) {
                    alert('포인트는 결제 금액을 넘을 수 없습니다')
                    $(this).val(0);
                    point = 0;
                }
                //쿠폰 할인 가격 계산.
                if(coupon > 0 && coupon <= 100) {
                    paymentPrice = (totalRewardPrice*(1 - (coupon/100+orderMemberDiscount)) - point  + deliver);
                } else {
                    paymentPrice =(totalRewardPrice*(1-orderMemberDiscount) - coupon - point  + deliver);
                }
                $('#totalOrderPoint').text(`${point.toLocaleString('ko-KR')}원`);
                $('#totalPayPrice').text(`${paymentPrice.toLocaleString('ko-KR')}원`);
                $('#totalOrderPoint').data('price', point);
                $('#totalPayPrice').data('price', paymentPrice);
            });



            // 이전 버튼 클릭시 페이지 이동
            $('.prevBtn').click(function(){
                $(this).parents('.info-contents-area').hide();
                $(this).parents('.info-contents-area').prev().show();
            });

            //배송 메세지 선택 시, 기타 옵션 선택하면 기타 요청사항 입력받게
            $('#deliverRequest').change(function(){
                let isElseSelected = $(this).val() === 'DELM_005';
                if(!isElseSelected){
                    $('#elseDeliverRequest').val('');
                }
                $('#elseDeliverRequest').prop('disabled',!isElseSelected);
            });

            //약관 체크 모두 될 시 모두 동의에 체크.
            $('.essential').not('#agreeNews').click(function(){
                let checkLength = $('.essential').not('#agreeNews').length;
                let checkedLength = $('.essential:checked').not('#agreeNews').length;
                let isAllCheck = checkLength === checkedLength;
                $('#allCheck').prop('checked',isAllCheck);
            });

            //약관 모두 동의 체크시 모두 동의
            $('#allCheck').click(function(){
                $('.essential').not('#agreeNews').prop('checked',$(this).prop('checked'));
            });

            //옵션 수량 음수로는 선택할 수 없고, 제한 수량을 초과하여 선택하지 못하게.
            let remainQuantity = $('.optionRemainQuantity').data('quantity');

            $('.optionAmount').change(function(){

                if($(this).val() < 1) {
                    $(this).val(1);
                } else if ( $(this).val() > remainQuantity){
                    alert('제한 수량을 초과하였습니다.');
                    $(this).val(remainQuantity);
                }
            });

            //옵션 선택될 시 기본값 1주고 수량 바꿀 수 있게, 선택 안될 시 값0으로 주고 수량 못바꾸게
            $('.selectOption input:checkbox').change(function(){
                let optionAmount = $(this).parent().find('.optionAmount');
                if($(this).prop('checked')) {
                    $(optionAmount).attr('readonly',false)
                    if($(optionAmount).val() < 1) {
                        $(optionAmount).val(1);
                    }
                } else{
                    $(optionAmount).val(0);
                    $(optionAmount).attr('readonly',true)
                }
            });

            //옵션 내용 높이조절.
            $('.rewardOptionContents').each((idx,item)=>{
                let height = $(item).prop('scrollHeight');
                let preHeight = $(item).height();
                $(item).css('height',`${height}px`);
            })

            //주소 찾기 클릭시 daum주소 api 호출
            $('.findAddrBtn, #deliverMemberAddr').click(function(){
                new daum.Postcode({
                    oncomplete: function(data) { //선택시 입력값 세팅
                        $('#deliverMemberAddr').val(data.address); // 주소 넣기
                    }
                }).open();
            });

            //기존 배송지 추가 체크시, 구매자 회원 배송지 입력
            $('#memberAddr').change(function(){
                let deliverMemberName = $('#deliverMemberName');
                let deliverMemberMobile = $('#deliverMemberMobile');
                let deliverMemberAddr = $('#deliverMemberAddr');
                let deliverMemberAddrDetail = $('#deliverMemberAddrDetail');

                if($(this).prop('checked')) {
                    $(deliverMemberName).val(name);
                    $(deliverMemberMobile).val(mobile);
                    $(deliverMemberAddr).val(addr);
                    $(deliverMemberAddrDetail).val(addrDetail);
                } else {
                    $(deliverMemberName).val('');
                    $(deliverMemberMobile).val('');
                    $(deliverMemberAddr).val('');
                    $(deliverMemberAddrDetail).val('');
                }

            });

            const clientKey = "test_ck_DpexMgkW36RWA44MXDDN3GbR5ozO"
            const customerKey = generateUUID();// 내 상점에서 고객을 구분하기 위해 발급한 고객의 고유 ID
            const orderId = generateUUID(); // 내 상점에서 주문을 구분하기 위해 발급한 고유햔 주문 ID
            const paymentWidget = PaymentWidget(clientKey, customerKey) // 회원 결제

            console.log(customerKey);
            console.log(orderId);
            // ------  결제위젯 초기화 ------
            const paymentMethodWidget = paymentWidget.renderPaymentMethods(
                "#payment-method",
                { value:0},
                { variantKey: "DEFAULT" }
            );

            // ------  이용약관 UI 렌더링 ------
            paymentWidget.renderAgreement(
                '#agreement',
                { variantKey: "AGREEMENT" } // 기본 이용약관 UI 렌더링
            );

            //결제하기 누를 시 필수 약관동의 모두 체크되었는지 확인
            $('.paymentBtn').click(function(){

                let validCheck = $('#paymentInfo').find('input[type="text"]').not('input:disabled');
                let isValid = true;

                //필수 약관 동의 체크
                $('.essential').each(function(idx,item){
                    if(!$(item).prop('checked')) {
                        alert('필수 약관에 모두 동의해주세요');
                        $(item).focus();
                        isValid = false;
                        return isValid;
                    }
                });

                //배송 정보 입력했는지 체크
                if(isValid) {
                    isValid = validationCheck(validCheck);
                    if(isValid) {
                        let totalPrice = $('#totalPayPrice').data('price');
                        //결재 이벤트 실행

                        const paymentMethodsWidget = paymentWidget.renderPaymentMethods(); // 결제창
                        const selectedPaymentMethod = paymentMethodsWidget.getSelectedPaymentMethod(); // 결제 정보

                        //토스 API결제 위젯에 최종 결제금액 업데이트
                        paymentMethodsWidget.updateAmount(totalPrice);

                        //결제 방법 paymentMethod 변수에 담기.
                        let paymentMethod= selectedPaymentMethod.method;
                        //결제 방법이 간편걸제라면 간편결제 중 무슨 결제인지 담기.
                        if(paymentMethod == '간편결제') {
                            paymentMethod = selectedPaymentMethod.easyPay.provider;
                        }

                        //토스페이API 결제 요청시 필요한 객체
                        const paymentObj = {
                            orderId: orderId,
                            orderName: [[${rewardOrderInfo.projectSubject}]],
                            amount: totalPrice,
                            customerEmail: [[${orderMemberInfo.memberEmail}]],
                            customerName: [[${orderMemberInfo.memberName}]],
                            mobilePhone: [[${orderMemberInfo.memberContactInfo}]],
                        };

                        //배송 요청 메세지가 '기타' 라면 상세 배송 요청 메세지 담기.
                        let deliveryMessage = $('#deliverRequest option:selected').text()
                        if(deliveryMessage == '기타') {
                            deliveryMessage = $('#elseDeliverRequest').val();
                        }

                        //배송 정보 deliveryMemberInfo 객체에 담기
                        const deliveryMemberInfo = {
                            deliveryMemberName : $('#deliverMemberName').val(),
                            deliveryMemberMobile : $('#deliverMemberMobile').val(),
                            deliveryMemberAddr : `${$('#deliverMemberAddr').val()}, ${$('#deliverMemberAddrDetail').val()}`,
                            deliveryMessageCode : $('#deliverRequest').val(),
                            deliveryMessage : deliveryMessage
                        }

                        //DB작업에 필요한 데이터 paymentParam 객체에 담기.
                        const paymentParam={
                            usePoint : Number($('#usePoint').val()),
                            deliveryPrice : $('#totalOrderDeliverPrice').data('price'),
                            useCouponCode : $('.orderUseCoupon option:selected').attr('id') ?? null,
                            couponIssueCode: $('.orderUseCoupon option:selected').attr('class') ?? null,
                            couponDiscountPrice : $('#totalOrderCoupon').data('price') ?? null,
                            memberRankDiscount :$('#memberRankDiscount').data('price'),
                            memberSavePoint :$('#memberSavePoint').data('price'),
                            orderPrice :$('#totalRewardPrice').data('price'),
                            totalPayPrice :$('#totalPayPrice').data('price'),
                            rewardProjectcode :[[${rewardOrderInfo.rewardProjectCode}]],
                            rewardProjectSubject : [[${rewardOrderInfo.projectSubject}]],
                            orderMemberName : name,
                            orderMemberId : id,
                            paymentMethod : paymentMethod,
                            rewardOptionList : products,
                            deliveryMemberInfo : deliveryMemberInfo
                        };

                        console.log(paymentParam);

                        //결제 신청
                        paymentWidget.requestPayment(paymentObj)
                            .then(response => {
                                paymentParam.paymentKey = response.paymentKey;
                                paymentParam.orderId = response.orderId;
                                paymentParam.amount = response.amount;

                                //결제 완료 후 DB작업을 위해 ajax요청
                                const request = $.ajax({
                                    type: 'POST',
                                    traditional: true,
                                    url: '/user/reward/payment',
                                    contentType: 'application/json',
                                    data: JSON.stringify(paymentParam),
                                    dataType: 'text'
                                });
                                //DB작업 완료 되었다면 결제 완료 페이지로 이동.
                                request.done(function(response){
                                    let redirectURI = response;
                                    location.href = redirectURI;
                                });
                                request.fail(function(err){
                                    console.log(err);
                                });
                            })
                    }
                }
            });
        });

        //사용 포인트 음수로 입력하지 못하게
        $(document).on('change', '#usePoint', function(){
            if($(this).val() < 0) {
                $(this).val(0);
            }
        });



    //리워드 상세 페이지에서 선택한 옵션 주문 페이지에서 선택 되도록.
    let selectedOptionCode = [[${rewardOptionCode}]];
    $(`#${selectedOptionCode}`).prop('checked',true);
    $(`#${selectedOptionCode}`).parents('.selectOption').find('.optionAmount').val(1);



    </script>








</th:block>


<!--/* layout:decorate : 파일에서 사용자 정의로 선언한 조각에 작성한 html 코드 삽입 */-->
<th:block layout:fragment="customContents">

    <section id="storeInnerGroup" class="content-wrap">

        <div class="main-section container">




            <div id="orderInfo" class="info-contents-area" style="display: block;">

                <div class="pricing-header p-3 pb-md-4 mx-auto text-center">
                    <figure class="text-center">
                        <blockquote class="blockquote">
                            <br>
                            <h3>리워드 상품을 선택해 주세요.</h3>

                        </blockquote>
                        <figcaption class="blockquote-footer">
                            <cite title="Source Title">지금 바로 플로키에서!</cite>
                        </figcaption>
                    </figure>
                </div>
                <div class="row">
                    <div class="col-lg-2"></div>

                    <div class="col-lg-8">

                        <form>
                            <h5>리워드 선택</h5>
                            <br>
                            <th:block  th:each="l : ${rewardOrderInfo.rewardOptionList}">
                                <div class="selectOption form-check mb-lg-2 text-dark" style="cursor: pointer">
                                    <input class="optionCheck form-check-input" type="checkbox" value="" th:id="${l.rewardOptionCode}">
                                    <div class="option" style="border: 1px solid #7D7D7D; border-radius: 25px;">
                                        <label class="form-check-label col-lg-12 pb-lg-3" th:for="${l.rewardOptionCode}">
                                            <span class="optionPrice font-weight-bold ml-2" th:text="|${#numbers.formatInteger(l.optionPrice, 0, 'COMMA')} 원|"
                                                  th:attr="data-price=${l.optionPrice}"></span>
                                            <span style="margin-left: 5px; background: #daf6fb; color: #235FD9; border-radius: 5px; padding: 2px;">
                                                <span class="optionRemainQuantity" th:text="|${#numbers.formatInteger(l.optionLimitQuantity - l.totalOrderQuantity, 0, 'COMMA')} 개 남음|"
                                                      th:data-quantity="${l.optionLimitQuantity - l.totalOrderQuantity}"></span>
                                            </span>
                                            <div style="border: 1px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <span class="optionName ml-2" th:text="${l.optionName}"></span>
                                            <div style="border: 1px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <textarea style="width: 90%; height: 20px; overflow: hidden; border: none; resize: none;" readonly="readonly" class="rewardOptionContents ml-2" th:text="${l.optionContents}"></textarea>
<!--                                            <span class="optionContents ml-2" th:text="${l.optionContents}"></span>-->
                                            <div style="border: 1px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <span class="ml-2">주문 수량</span>
                                            <input type="number" class="optionAmount float-right mr-lg-2 h-75" style="width: 40px" value="0" readonly="readonly">
                                            <div style="border: 1px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <span class="ml-2">배송비</span>
                                            <span class ="optionDeliverPrice font-weight-bold float-right mr-2" th:if="${l.optionDeliveryPrice} == 0" th:attr="data-price=${l.optionDeliveryPrice}">무료 배송</span>
                                            <span class ="optionDeliverPrice font-weight-bold float-right mr-2" th:unless="${l.optionDeliveryPrice} == 0" th:text="|${#numbers.formatInteger(l.optionDeliveryPrice, 0, 'COMMA')} 원|"
                                                  th:attr="data-price=${l.optionDeliveryPrice}"></span>
                                            <div style="border: 1px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <span class="ml-2">발송 시작일</span>
                                            <span class ="optionDeliverDate font-weight-bold float-right mr-2" th:text="${#strings.substring(l.optionEstimatedDeliveryDate,0,10)}"></span>
                                            <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                            <span class="ml-2">제한 수량</span>
                                            <span class ="optionLimitQuantity font-weight-bold float-right mr-2 text-danger" th:text="${l.optionLimitQuantity}"></span>
                                        </label>
                                    </div>
                                </div>
                            </th:block>


                            <br>
                            <div class="d-flex justify-content-center">
                                <button class="nextBtn w-80 btn btn-primary btn-lg" type="button">다음단계</button>
                            </div>
                        </form>

                    </div>
                </div>

            </div>


            <div id="paymentInfo" class="info-contents-area" style="display: none;">

                <div class="pricing-header p-3 pb-md-4 mx-auto text-center">
                    <figure class="text-center">
                        <blockquote class="blockquote">
                            <br>
                            <h3>결제 정보를 작성해주세요</h3>
                        </blockquote>
                        <figcaption class="blockquote-footer">
                            <cite title="Source Title">지금 바로 플로키에서!</cite>
                        </figcaption>
                    </figure>
                </div>

                <div class="row text-dark">
                    <div class="col-lg-2"></div>

                    <div class="col-lg-8">

                        <form>
                            <h5>결제 하기</h5>
                            <br>
                            <div id="selectedOption">
                            </div>

                            <div style="border: 0.3px solid black; margin: 5px; width: 100%"></div>

                            <span class="ml-2">배송비</span>
                            <span class="orderOptionDeliverPrice font-weight-bold float-right mr-2">무료 배송</span>
                            <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                            <span class="ml-2">쿠폰 사용</span>
                            <span class ="font-weight-bold float-right mr-2">
                                <select class="orderUseCoupon">
                                    <option value="">===쿠폰을 선택해주세요===</option>
                                         <th:block th:if="${memberHaveCouponList == null}">
                                            <option value="0">보유 쿠폰이 없습니다.</option>
                                         </th:block>
                                         <th:block th:unless="${memberHaveCouponList == null}" th:each="l : ${memberHaveCouponList}">
                                            <option th:if="${l.couponDiscountRate > 0}" th:text="${l.couponName}" th:value="${l.couponDiscountRate}" th:id="${l.couponCode}" th:class="${l.memberCoupon.couponIssueCode}"></option>
                                            <option th:if="${l.couponDiscountAmount > 0}" th:text="${l.couponName}" th:value="${l.couponDiscountAmount}" th:id="${l.couponCode}" th:class="${l.memberCoupon.couponIssueCode}"></option>
                                          </th:block>
                                </select>
                            </span>
                            <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                            <span class="ml-2">포인트 사용</span>
                            <div class="form-check float-right font-weight-bold float-right mr-1">
                                <input class="form-check-input" type="checkbox" value="" id="pointAllCheck">
                                <label class="form-check-label" for="pointAllCheck">
                                    모두 사용 (보유 포인트 <span id="havePoint" class="text-primary">0</span> P)
                                </label>
                                <br>
                                <input id="usePoint" type="number" class="float-right mr-2 h-75" value="0" style="width: 80px;">
                            </div>

                            <br><br>
                            <div style="border: 0.3px solid black; margin: 5px; width: 100%"></div>




                            <br><br><br>
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="mr-lg-2">서포터</h5>
                                    <div class=" ml-lg-2 bg-light">
                                        <div class="ml-lg-2">

                                            <p class="font-weight-bold" >이름</p>
                                            <p id="memberName" th:text="${orderMemberInfo.memberName}"></p>
                                            <p class="mt-lg-3 font-weight-bold">이메일</p>
                                            <p id="memberEmail" th:text="${orderMemberInfo.memberEmail}"></p>
                                            <p class="mt-lg-3 font-weight-bold">휴대폰 번호</p>
                                            <p id="memberMobile" class="mb-lg-5" th:text="${orderMemberInfo.memberContactInfo}"></p>

                                            <div class="form-check">
                                                <input class="essential form-check-input" type="checkbox" value="" id="agreeNews">
                                                <label class="form-check-label" for="agreeNews">
                                                    (필수) 프로젝트 진행에 대한 새소식 및 결제 관련 안내를 받습니다
                                                </label>
                                            </div>

                                        </div>
                                    </div>

                                </div>

                                <div class="col-6">
                                    <div class="ml-lg-3">
                                        <h5 class="mr-lg-2">리워드 배송지</h5>

                                        <div class="form-check mt-lg-3">
                                            <input class="form-check-input" type="checkbox" value="" id="memberAddr">
                                            <label class="form-check-label font-weight-bold" for="memberAddr">
                                                기존 배송지 추가
                                            </label>
                                        </div>

                                        <label for="deliverMemberName" class="font-weight-bold text-dark mt-lg-2">이름</label>
                                        <br>
                                        <input type="text" class="w-100" id="deliverMemberName" value="" style="height: 35px">
                                        <br>
                                        <label for="deliverMemberMobile" class="font-weight-bold text-dark mt-lg-2">휴대폰번호</label>
                                        <br>
                                        <input type="text" class="w-100" id="deliverMemberMobile" value="" style="height: 35px">
                                        <br>
                                        <label for="deliverMemberAddr" class="font-weight-bold text-dark mt-lg-2">주소</label>
                                        <br>
                                        <button type="button" class="findAddrBtn btn btn-small btn-secondary" id="findAddrBtn">주소 찾기</button>
                                        <br>
                                        <input type="text" class="w-100 mt-lg-1" id="deliverMemberAddr" value="" style="height: 35px" placeholder="주소를 입력해 주세요" readonly="readonly">
                                        <label for="deliverMemberAddrDetail" hidden="hidden">상세 주소</label>
                                        <input type="text" class="w-100 mt-lg-1" id="deliverMemberAddrDetail" value="" style="height: 35px" placeholder="상세 주소를 입력해 주세요">
                                        <br>
                                        <label for="deliverRequest" class="font-weight-bold text-dark mt-lg-2">배송 요청사항</label>
                                        <br>
                                        <select id="deliverRequest">
                                            <option th:each="l : ${deliveryMessageList}" th:value="${l.deliveryMessageCode}" th:text="${l.deliveryMessageContect}"></option>
                                        </select>
                                        <br>
                                        <label for="elseDeliverRequest" hidden="hidden">기타 배송요청사항</label>
                                        <input type="text" class="w-100 mt-lg-2" id="elseDeliverRequest" value="" style="height: 35px" placeholder="기타" disabled>
                                        <br>

                                    </div>
                                </div>
                            </div>

                            <div class="mt-lg-5 mb-lg-5" style="border: 1px solid #4d4d4d; margin: 5px; width: 100%"></div>

                            <div class="ml-lg-2">
                                <h5>결제 금액</h5>
                                <div id="paymentPrice" class="ml-lg-3 mt-lg-4">

                                    <div>
                                        <input type="number" id="totalPayPriceHidden" hidden="hidden" ></input>
                                        <span class="ml-2">리워드 금액</span>
                                        <span id="totalRewardPrice" class=" font-weight-bold float-right mr-lg-2"></span>
                                        <div style="border: 0.2px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                        <span class="ml-2">포인트 사용 금액</span>
                                        <span id="totalOrderPoint" class=" font-weight-bold float-right mr-lg-2">0원</span>
                                        <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                        <span class="ml-2">쿠폰 할인 금액</span>
                                        <span id="totalOrderCoupon" class=" font-weight-bold float-right mr-lg-2">0원</span>
                                        <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                        <span class="ml-2">등급 할인 금액</span>
                                        <span id="memberRankDiscount" class=" font-weight-bold float-right mr-lg-2">0원</span>
                                        <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                        <span class="ml-2">배송비</span>
                                        <span id="totalOrderDeliverPrice" class=" font-weight-bold float-right mr-lg-2">무료 배송</span>
                                        <div style="border: 0.3px solid #f3f4f5; margin: 5px; width: 100%"></div>

                                        <span class="ml-2 text-primary">적립 포인트</span>
                                        <span id="memberSavePoint" class=" font-weight-bold float-right mr-lg-2 text-primary">0원</span>
                                        <div style="border: 2px solid #f3f4f5; margin: 10px; width: 100%"></div>

                                        <span class="ml-2 font-weight-bold" style="font-size: 20px">총 결제 금액</span>
                                        <span id="totalPayPrice" class="font-weight-bold float-right mr-lg-2" style="font-size: 20px"></span>

                                    </div>
                                </div>
                            </div>




                            <div class="mt-lg-5 mb-lg-5" style="border: 1px solid #4d4d4d; margin: 5px; width: 100%"></div>

                            <div class="ml-lg-2">
                                <!-- 결제 방법 영역-->
                                <div id="payment-method"></div>

<!--                                <button id="payment-button" type="button">결제하기</button>-->
                            </div>

                            <div class="ml-lg-2 mt-lg-5">
                                <h5>약관 동의</h5>
                                <div class="ml-lg-3 mt-lg-4">

                                    <div id="agreement"></div>

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="allCheck">
                                        <label class="form-check-label" for="allCheck">
                                            필수 약관 모두동의
                                        </label>
                                    </div>
                                    <div style="border: 0.2px solid #f3f4f5; margin: 5px; width: 100%"></div>
                                    <div class="form-check">
                                        <input class="essential form-check-input" type="checkbox" value="" id="agree1">
                                        <label class="form-check-label" for="agree1">
                                            구매조건, 결제 진행 및 결제 대행 서비스 동의(필수)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="essential form-check-input" type="checkbox" value="" id="agree2">
                                        <label class="form-check-label" for="agree2">
                                            개인정보 제3자 제공 동의 (필수)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="essential form-check-input" type="checkbox" value="" id="agree3">
                                        <label class="form-check-label" for="agree3">
                                            책임 규정에 대한 동의 (필수)
                                        </label>
                                    </div>
                                </div>
                            </div>


                            <br><br>
                            <div class="d-flex justify-content-center">
                                <button class="prevBtn w-80 btn btn-secondary btn-lg" type="button">이전단계</button>
                                <button class="paymentBtn w-80 btn btn-primary  btn-lg" type="button">결제하기</button>
                            </div>
                        </form>
                        <br>
                        <br>
                    </div>


                </div>

            </div>

        </div>

    </section>



</th:block>
</html>